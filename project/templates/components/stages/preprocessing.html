<!-- components/stages/preprocessing.html -->

<!-- 데이터 선택 블록 (필수) -->
<div class="block block-pre block-required" id="block-data-select" data-active="true">
    <div class="block-header">
        <span class="block-title">
            <span class="block-status"></span>
            데이터 선택
        </span>
    </div>
    <div class="block-content">
        <div class="block-field">
            <label for="dataset">훈련 데이터</label>
            <select name="dataset" id="dataset" required>
                <option value="">선택...</option>
                {% for opt in options %}
                <option value="{{ opt }}" {% if form_state.dataset == opt %}selected{% endif %}>{{ opt }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="block-field">
            <label for="is_test">테스트 데이터</label>
            <select name="is_test" id="is_test">
                <option value="false" {% if form_state.is_test != 'true' %}selected{% endif %}>자동 분할</option>
                <option value="true" {% if form_state.is_test == 'true' %}selected{% endif %}>별도 파일</option>
            </select>
        </div>
        
        <div id="test-div" class="conditional-field {% if form_state.is_test != 'true' %}hidden{% endif %}">
            <div class="block-field">
                <label for="testdataset">테스트 파일</label>
                <select name="testdataset" id="testdataset">
                    <option value="">선택...</option>
                    {% for opt in options %}
                    <option value="{{ opt }}" {% if form_state.testdataset == opt %}selected{% endif %}>{{ opt }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div id="ratio-div" class="conditional-field {% if form_state.is_test == 'true' %}hidden{% endif %}">
            <div class="block-field">
                <label for="a">훈련 비율(%)</label>
                <input type="number" name="a" id="a" value="{{ form_state.a|default(80) }}" min="10" max="90" step="5">
            </div>
        </div>
    </div>
</div>

<!-- 결측치 제거 블록 -->
<div class="block block-pre" id="block-drop-na" data-active="{% if form_state.drop_na %}true{% else %}false{% endif %}">
    <div class="block-header">
        <span class="block-title">
            <span class="block-status"></span>
            결측치 제거
        </span>
    </div>
    <div class="block-content">
        <div class="checkbox-item">
            <input type="checkbox" name="drop_na" id="drop_na" {% if form_state.drop_na %}checked{% endif %}>
            <label for="drop_na">결측치가 있는 행 제거</label>
        </div>
    </div>
</div>

<!-- 잘못된 라벨 제거 블록 -->
<div class="block block-pre" id="block-drop-bad" data-active="{% if form_state.drop_bad %}true{% else %}false{% endif %}">
    <div class="block-header">
        <span class="block-title">
            <span class="block-status"></span>
            라벨 필터링
        </span>
    </div>
    <div class="block-content">
        <div class="checkbox-item">
            <input type="checkbox" name="drop_bad" id="drop_bad" {% if form_state.drop_bad %}checked{% endif %}>
            <label for="drop_bad">잘못된 라벨 제거</label>
        </div>
        
        <div id="drop_bad_params" class="conditional-field {% if not form_state.drop_bad %}hidden{% endif %}">
            <div class="inline-fields">
                <div class="block-field">
                    <label for="min_label">최소</label>
                    <input type="number" name="min_label" id="min_label" value="{{ form_state.min_label|default(0) }}" min="0">
                </div>
                <div class="block-field">
                    <label for="max_label">최대</label>
                    <input type="number" name="max_label" id="max_label" value="{{ form_state.max_label|default(9) }}" min="0">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- X/y 분리 블록 -->
<div class="block block-pre" id="block-split-xy" data-active="{% if form_state.split_xy %}true{% else %}false{% endif %}">
    <div class="block-header">
        <span class="block-title">
            <span class="block-status"></span>
            입력/라벨 분리
        </span>
    </div>
    <div class="block-content">
        <div class="checkbox-item">
            <input type="checkbox" name="split_xy" id="split_xy" {% if form_state.split_xy %}checked{% endif %}>
            <label for="split_xy">X(입력)와 y(라벨) 분리</label>
        </div>
        <p class="help-text">첫 번째 열을 라벨로, 나머지를 입력으로 분리합니다.</p>
    </div>
</div>

<!-- 이미지 리사이즈 블록 -->
<div class="block block-pre" id="block-resize" data-active="{% if form_state.resize_n %}true{% else %}false{% endif %}">
    <div class="block-header">
        <span class="block-title">
            <span class="block-status"></span>
            이미지 크기 조정
        </span>
    </div>
    <div class="block-content">
        <div class="block-field">
            <label for="resize_n">크기 (n×n)</label>
            <input type="number" name="resize_n" id="resize_n" value="{{ form_state.resize_n|default(28) }}" min="8" max="256" step="8">
        </div>
    </div>
</div>

<!-- 데이터 증강 블록 -->
<div class="block block-pre" id="block-augment" data-active="{% if form_state.augment_method %}true{% else %}false{% endif %}">
    <div class="block-header">
        <span class="block-title">
            <span class="block-status"></span>
            데이터 증강
        </span>
    </div>
    <div class="block-content">
        <div class="block-field">
            <label for="augment_method">증강 방법</label>
            <select name="augment_method" id="augment_method">
                <option value="">없음</option>
                <option value="rotate" {% if form_state.augment_method == 'rotate' %}selected{% endif %}>회전</option>
                <option value="hflip" {% if form_state.augment_method == 'hflip' %}selected{% endif %}>좌우 반전</option>
                <option value="vflip" {% if form_state.augment_method == 'vflip' %}selected{% endif %}>상하 반전</option>
                <option value="translate" {% if form_state.augment_method == 'translate' %}selected{% endif %}>평행이동</option>
            </select>
        </div>
        
        <div class="block-field">
            <label for="augment_param">파라미터</label>
            <input type="number" name="augment_param" id="augment_param" value="{{ form_state.augment_param|default(15) }}" min="0" max="90">
            <p class="help-text">회전: 각도, 평행이동: 픽셀</p>
        </div>
    </div>
</div>

<!-- 정규화 블록 -->
<div class="block block-pre" id="block-normalize" data-active="{% if form_state.normalize %}true{% else %}false{% endif %}">
    <div class="block-header">
        <span class="block-title">
            <span class="block-status"></span>
            정규화
        </span>
    </div>
    <div class="block-content">
        <div class="block-field">
            <label for="normalize">정규화 방법</label>
            <select name="normalize" id="normalize">
                <option value="">없음</option>
                <option value="0-1" {% if form_state.normalize == '0-1' %}selected{% endif %}>[0, 1] 범위</option>
                <option value="-1-1" {% if form_state.normalize == '-1-1' %}selected{% endif %}>[-1, 1] 범위</option>
            </select>
        </div>
    </div>
</div>