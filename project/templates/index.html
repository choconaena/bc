<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ë¸”ë¡ì½”ë”© - ì™„ì „ í†µí•© ë²„ì „</title>
    
    <style>
        /* ===== CSS ë³€ìˆ˜ ì •ì˜ ===== */
        :root {
            --color-primary: #2563eb;
            --color-success: #16a34a;
            --color-warning: #ea580c;
            --color-danger: #dc2626;
            --color-info: #0891b2;
            
            --color-pre: #4ade80;
            --color-model: #60a5fa;
            --color-train: #fb923c;
            --color-eval: #f87171;
            
            --color-bg: #ffffff;
            --color-bg-secondary: #f8fafc;
            --color-border: #e2e8f0;
            --color-text: #1e293b;
            --color-text-secondary: #64748b;
            
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            
            --radius-sm: 0.25rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            
            --transition: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 14px;
            line-height: 1.6;
            color: var(--color-text);
            background: var(--color-bg);
        }

        /* ë ˆì´ì•„ì›ƒ */
        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        .sidebar {
            width: 380px;
            background: var(--color-bg-secondary);
            border-right: 1px solid var(--color-border);
            overflow-y: auto;
            padding: var(--spacing-md);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* íƒ­ í—¤ë” */
        .tab-header {
            display: flex;
            background: var(--color-bg);
            border-bottom: 1px solid var(--color-border);
            padding: 0 var(--spacing-md);
        }

        .tab-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-lg);
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            color: var(--color-text-secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .tab-btn:hover {
            color: var(--color-text);
            background: var(--color-bg-secondary);
        }

        .tab-btn.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        /* íƒ­ ì½˜í…ì¸  */
        .tab-content {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .tab-panel {
            display: none;
            height: 100%;
            overflow-y: auto;
            padding: var(--spacing-lg);
        }

        .tab-panel.active {
            display: block;
        }

        /* ìŠ¤í…Œì´ì§€ íƒ­ */
        .stage-tabs {
            display: flex;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm);
            background: white;
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
        }

        .stage-tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm);
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 500;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .stage-tab:hover {
            background: white;
            color: var(--color-text);
        }

        .stage-tab.active {
            background: white;
            color: var(--color-text);
            border-color: var(--color-primary);
            box-shadow: var(--shadow-sm);
        }

        .stage-tab.active[data-stage="pre"] {
            border-color: var(--color-pre);
            color: var(--color-pre);
        }

        .stage-tab.active[data-stage="model"] {
            border-color: var(--color-model);
            color: var(--color-model);
        }

        .stage-tab.active[data-stage="train"] {
            border-color: var(--color-train);
            color: var(--color-train);
        }

        .stage-tab.active[data-stage="eval"] {
            border-color: var(--color-eval);
            color: var(--color-eval);
        }

        /* ìŠ¤í…Œì´ì§€ íŒ¨ë„ */
        .stage-panels {
            max-height: calc(100vh - 300px);
            overflow-y: auto;
        }

        .stage-panel {
            display: none;
        }

        .stage-panel.active {
            display: block;
        }

        /* ë¸”ë¡ ìŠ¤íƒ€ì¼ */
        .block {
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-md);
            background: white;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            transition: var(--transition);
            position: relative;
        }

        .block:hover {
            box-shadow: var(--shadow-sm);
        }

        .block-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-sm);
        }

        .block-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--color-text);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .block-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-success);
            transition: var(--transition);
        }

        .block-content {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .block-field {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .block-field label {
            min-width: 120px;
            margin: 0;
            color: var(--color-text-secondary);
            font-weight: 500;
        }

        .block-field input[type="text"],
        .block-field input[type="number"],
        .block-field select {
            flex: 1;
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 14px;
        }

        /* ì¡°ê±´ë¶€ í•„ë“œ */
        .conditional-field {
            margin-top: var(--spacing-sm);
            padding: var(--spacing-sm);
            background: var(--color-bg-secondary);
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .conditional-field.hidden {
            display: none !important;
        }

        .hidden {
            display: none !important;
        }

        /* ì²´í¬ë°•ìŠ¤ */
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        /* ë²„íŠ¼ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: var(--color-success);
            color: white;
        }

        .btn-success:hover {
            background: #15803d;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--color-bg-secondary);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-danger {
            background: var(--color-danger);
            color: white;
        }

        /* ì•¡ì…˜ ë²„íŠ¼ */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-lg);
            padding: var(--spacing-md);
            background: white;
            border-radius: var(--radius-md);
        }

        .action-buttons .btn {
            width: 100%;
        }

        /* ì½”ë“œ ë·°ì–´ */
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            background: white;
            border-bottom: 1px solid var(--color-border);
        }

        .code-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .code-view {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: var(--spacing-lg);
            border-radius: var(--radius-md);
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            overflow-x: auto;
            max-height: calc(100vh - 200px);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* ë¡œê·¸ ë·°ì–´ */
        .log-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .log-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            background: white;
            border-bottom: 1px solid var(--color-border);
        }

        .log-viewer {
            flex: 1;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: var(--spacing-md);
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
            overflow-y: auto;
        }

        .log-line {
            margin-bottom: 2px;
        }

        .log-line.error {
            color: #f87171;
        }

        .log-line.success {
            color: #4ade80;
        }

        .log-line.info {
            color: #60a5fa;
        }

        .log-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) var(--spacing-md);
            background: white;
            border-top: 1px solid var(--color-border);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-text-secondary);
        }

        .status-indicator.running .status-dot {
            background: var(--color-success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-xl);
            text-align: center;
            min-height: 300px;
        }

        .help-text {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-top: var(--spacing-xs);
        }

        .inline-fields {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
        }

        .inline-fields > * {
            flex: 1;
        }

        /* ì¹´í…Œê³ ë¦¬ë³„ ìƒ‰ìƒ */
        .block-pre { border-left: 3px solid var(--color-pre); }
        .block-model { border-left: 3px solid var(--color-model); }
        .block-train { border-left: 3px solid var(--color-train); }
        .block-eval { border-left: 3px solid var(--color-eval); }

        /* ìŠ¤í…Œì´ì§€ë³„ ë²„íŠ¼ ìƒ‰ìƒ */
        .btn-stage-pre { background: var(--color-pre); color: white; }
        .btn-stage-model { background: var(--color-model); color: white; }
        .btn-stage-train { background: var(--color-train); color: white; }
        .btn-stage-eval { background: var(--color-eval); color: white; }
    </style>
</head>
<body>
    <div id="app" class="app-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="sidebar">
            <form id="pipeline-form" method="post" action="/convert">
                <!-- ìŠ¤í…Œì´ì§€ íƒ­ -->
                <div class="stage-tabs">
                    <button type="button" class="stage-tab active" data-stage="pre">
                        <span>ğŸŸ©</span> ì „ì²˜ë¦¬
                    </button>
                    <button type="button" class="stage-tab" data-stage="model">
                        <span>ğŸŸ¦</span> ëª¨ë¸
                    </button>
                    <button type="button" class="stage-tab" data-stage="train">
                        <span>ğŸŸ§</span> í•™ìŠµ
                    </button>
                    <button type="button" class="stage-tab" data-stage="eval">
                        <span>ğŸŸ¥</span> í‰ê°€
                    </button>
                </div>
                
                <!-- ìŠ¤í…Œì´ì§€ íŒ¨ë„ë“¤ -->
                <div class="stage-panels">
                    <!-- ì „ì²˜ë¦¬ íŒ¨ë„ -->
                    <div class="stage-panel active" data-stage-panel="pre">
                        <!-- ë°ì´í„° ì„ íƒ ë¸”ë¡ -->
                        <div class="block block-pre">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    ë°ì´í„° ì„ íƒ
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="block-field">
                                    <label for="dataset">í›ˆë ¨ ë°ì´í„°</label>
                                    <select name="dataset" id="dataset" required>
                                        <option value="">ì„ íƒ...</option>
                                        {% for opt in options %}
                                        <option value="{{ opt }}" {% if form_state.dataset == opt %}selected{% endif %}>{{ opt }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                
                                <div class="block-field">
                                    <label for="is_test">í…ŒìŠ¤íŠ¸ ë°ì´í„°</label>
                                    <select name="is_test" id="is_test">
                                        <option value="false" {% if form_state.is_test != 'true' %}selected{% endif %}>ìë™ ë¶„í• </option>
                                        <option value="true" {% if form_state.is_test == 'true' %}selected{% endif %}>ë³„ë„ íŒŒì¼</option>
                                    </select>
                                </div>
                                
                                <div id="test-div" class="conditional-field {% if form_state.is_test != 'true' %}hidden{% endif %}">
                                    <div class="block-field">
                                        <label for="testdataset">í…ŒìŠ¤íŠ¸ íŒŒì¼</label>
                                        <select name="testdataset" id="testdataset">
                                            <option value="">ì„ íƒ...</option>
                                            {% for opt in options %}
                                            <option value="{{ opt }}" {% if form_state.testdataset == opt %}selected{% endif %}>{{ opt }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                
                                <div id="ratio-div" class="conditional-field {% if form_state.is_test == 'true' %}hidden{% endif %}">
                                    <div class="block-field">
                                        <label for="a">í›ˆë ¨ ë¹„ìœ¨(%)</label>
                                        <input type="number" name="a" id="a" value="{{ form_state.a|default(80) }}" min="10" max="90" step="5">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ê²°ì¸¡ì¹˜ ì œê±° ë¸”ë¡ -->
                        <div class="block block-pre">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    ê²°ì¸¡ì¹˜ ì œê±°
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="checkbox-item">
                                    <input type="checkbox" name="drop_na" id="drop_na" {% if form_state.drop_na %}checked{% endif %}>
                                    <label for="drop_na">ê²°ì¸¡ì¹˜ê°€ ìˆëŠ” í–‰ ì œê±°</label>
                                </div>
                            </div>
                        </div>

                        <!-- X/y ë¶„ë¦¬ ë¸”ë¡ -->
                        <div class="block block-pre">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    ì…ë ¥/ë¼ë²¨ ë¶„ë¦¬
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="checkbox-item">
                                    <input type="checkbox" name="split_xy" id="split_xy" {% if form_state.split_xy %}checked{% endif %}>
                                    <label for="split_xy">X(ì…ë ¥)ì™€ y(ë¼ë²¨) ë¶„ë¦¬</label>
                                </div>
                                <p class="help-text">ì²« ë²ˆì§¸ ì—´ì„ ë¼ë²¨ë¡œ, ë‚˜ë¨¸ì§€ë¥¼ ì…ë ¥ìœ¼ë¡œ ë¶„ë¦¬í•©ë‹ˆë‹¤.</p>
                            </div>
                        </div>

                        <!-- ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆ ë¸”ë¡ -->
                        <div class="block block-pre">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    ì´ë¯¸ì§€ í¬ê¸° ì¡°ì •
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="block-field">
                                    <label for="resize_n">í¬ê¸° (nÃ—n)</label>
                                    <input type="number" name="resize_n" id="resize_n" value="{{ form_state.resize_n|default(28) }}" min="8" max="256" step="8">
                                </div>
                            </div>
                        </div>

                        <!-- ì •ê·œí™” ë¸”ë¡ -->
                        <div class="block block-pre">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    ì •ê·œí™”
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="block-field">
                                    <label for="normalize">ì •ê·œí™” ë°©ë²•</label>
                                    <select name="normalize" id="normalize">
                                        <option value="">ì—†ìŒ</option>
                                        <option value="0-1" {% if form_state.normalize == '0-1' %}selected{% endif %}>[0, 1] ë²”ìœ„</option>
                                        <option value="-1-1" {% if form_state.normalize == '-1-1' %}selected{% endif %}>[-1, 1] ë²”ìœ„</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ëª¨ë¸ íŒ¨ë„ -->
                    <div class="stage-panel" data-stage-panel="model">
                        <!-- ì…ë ¥ì¸µ ë¸”ë¡ -->
                        <div class="block block-model">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    ì…ë ¥ì¸µ ì„¤ì •
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="inline-fields">
                                    <div class="block-field">
                                        <label for="input_w">ë„ˆë¹„</label>
                                        <input type="number" name="input_w" id="input_w" value="{{ form_state.input_w|default(28) }}" min="1" max="512">
                                    </div>
                                    <div class="block-field">
                                        <label for="input_h">ë†’ì´</label>
                                        <input type="number" name="input_h" id="input_h" value="{{ form_state.input_h|default(28) }}" min="1" max="512">
                                    </div>
                                    <div class="block-field">
                                        <label for="input_c">ì±„ë„</label>
                                        <input type="number" name="input_c" id="input_c" value="{{ form_state.input_c|default(1) }}" min="1" max="3">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Conv1 ë¸”ë¡ -->
                        <div class="block block-model">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    Convolution Layer 1
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="block-field">
                                    <label for="conv1_filters">í•„í„° ìˆ˜</label>
                                    <input type="number" name="conv1_filters" id="conv1_filters" value="{{ form_state.conv1_filters|default(32) }}" min="1" max="512">
                                </div>
                                <div class="block-field">
                                    <label for="conv1_kernel">ì»¤ë„ í¬ê¸°</label>
                                    <input type="number" name="conv1_kernel" id="conv1_kernel" value="{{ form_state.conv1_kernel|default(3) }}" min="1" max="11" step="2">
                                </div>
                                <div class="block-field">
                                    <label for="conv1_padding">íŒ¨ë”©</label>
                                    <select name="conv1_padding" id="conv1_padding">
                                        <option value="same" {% if form_state.conv1_padding == 'same' %}selected{% endif %}>Same</option>
                                        <option value="valid" {% if form_state.conv1_padding == 'valid' %}selected{% endif %}>Valid</option>
                                    </select>
                                </div>
                                <div class="block-field">
                                    <label for="conv1_activation">í™œì„± í•¨ìˆ˜</label>
                                    <select name="conv1_activation" id="conv1_activation">
                                        <option value="relu" {% if form_state.conv1_activation == 'relu' %}selected{% endif %}>ReLU</option>
                                        <option value="tanh" {% if form_state.conv1_activation == 'tanh' %}selected{% endif %}>Tanh</option>
                                        <option value="sigmoid" {% if form_state.conv1_activation == 'sigmoid' %}selected{% endif %}>Sigmoid</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Pooling ë¸”ë¡ -->
                        <div class="block block-model">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    Pooling Layer
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="block-field">
                                    <label for="pool1_type">í’€ë§ ì¢…ë¥˜</label>
                                    <select name="pool1_type" id="pool1_type">
                                        <option value="">ì—†ìŒ</option>
                                        <option value="max" {% if form_state.pool1_type == 'max' %}selected{% endif %}>Max Pooling</option>
                                        <option value="avg" {% if form_state.pool1_type == 'avg' %}selected{% endif %}>Average Pooling</option>
                                    </select>
                                </div>
                                <div class="inline-fields">
                                    <div class="block-field">
                                        <label for="pool1_size">í¬ê¸°</label>
                                        <input type="number" name="pool1_size" id="pool1_size" value="{{ form_state.pool1_size|default(2) }}" min="2" max="5">
                                    </div>
                                    <div class="block-field">
                                        <label for="pool1_stride">ìŠ¤íŠ¸ë¼ì´ë“œ</label>
                                        <input type="number" name="pool1_stride" id="pool1_stride" value="{{ form_state.pool1_stride|default(2) }}" min="1" max="5">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dense ë¸”ë¡ -->
                        <div class="block block-model">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    Fully Connected Layer
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="block-field">
                                    <label for="dense_units">ìœ ë‹› ìˆ˜</label>
                                    <input type="number" name="dense_units" id="dense_units" value="{{ form_state.dense_units|default(128) }}" min="1" max="2048">
                                </div>
                                <div class="block-field">
                                    <label for="dense_activation">í™œì„± í•¨ìˆ˜</label>
                                    <select name="dense_activation" id="dense_activation">
                                        <option value="relu" {% if form_state.dense_activation == 'relu' %}selected{% endif %}>ReLU</option>
                                        <option value="tanh" {% if form_state.dense_activation == 'tanh' %}selected{% endif %}>Tanh</option>
                                        <option value="sigmoid" {% if form_state.dense_activation == 'sigmoid' %}selected{% endif %}>Sigmoid</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Output ë¸”ë¡ -->
                        <div class="block block-model">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    ì¶œë ¥ì¸µ
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="block-field">
                                    <label for="num_classes">í´ë˜ìŠ¤ ìˆ˜</label>
                                    <input type="number" name="num_classes" id="num_classes" value="{{ form_state.num_classes|default(10) }}" min="2" max="1000">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- í•™ìŠµ íŒ¨ë„ -->
                    <div class="stage-panel" data-stage-panel="train">
                        <!-- ì†ì‹¤í•¨ìˆ˜ ë¸”ë¡ -->
                        <div class="block block-train">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    ì†ì‹¤ í•¨ìˆ˜
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="block-field">
                                    <label for="loss_method">ì†ì‹¤ í•¨ìˆ˜</label>
                                    <select name="loss_method" id="loss_method">
                                        <option value="CrossEntropy" {% if form_state.loss_method == 'CrossEntropy' %}selected{% endif %}>Cross Entropy</option>
                                        <option value="MSE" {% if form_state.loss_method == 'MSE' %}selected{% endif %}>Mean Squared Error</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- ì˜µí‹°ë§ˆì´ì € ë¸”ë¡ -->
                        <div class="block block-train">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    ì˜µí‹°ë§ˆì´ì €
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="block-field">
                                    <label for="optimizer_method">ì˜µí‹°ë§ˆì´ì €</label>
                                    <select name="optimizer_method" id="optimizer_method">
                                        <option value="Adam" {% if form_state.optimizer_method == 'Adam' %}selected{% endif %}>Adam</option>
                                        <option value="SGD" {% if form_state.optimizer_method == 'SGD' %}selected{% endif %}>SGD</option>
                                        <option value="RMSprop" {% if form_state.optimizer_method == 'RMSprop' %}selected{% endif %}>RMSprop</option>
                                    </select>
                                </div>
                                <div class="block-field">
                                    <label for="learning_rate">í•™ìŠµë¥ </label>
                                    <input type="number" name="learning_rate" id="learning_rate" value="{{ form_state.learning_rate|default(0.001) }}" min="0.000001" max="1" step="0.0001">
                                </div>
                            </div>
                        </div>

                        <!-- í•™ìŠµ ì„¤ì • ë¸”ë¡ -->
                        <div class="block block-train">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    í•™ìŠµ ì„¤ì •
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="block-field">
                                    <label for="epochs">ì—í­ ìˆ˜</label>
                                    <input type="number" name="epochs" id="epochs" value="{{ form_state.epochs|default(10) }}" min="1" max="1000">
                                </div>
                                <div class="block-field">
                                    <label for="batch_size">ë°°ì¹˜ í¬ê¸°</label>
                                    <input type="number" name="batch_size" id="batch_size" value="{{ form_state.batch_size|default(64) }}" min="1" max="512">
                                </div>
                                <div class="block-field">
                                    <label for="patience">Early Stopping</label>
                                    <input type="number" name="patience" id="patience" value="{{ form_state.patience|default(3) }}" min="0" max="50">
                                    <p class="help-text">0ìœ¼ë¡œ ì„¤ì •í•˜ë©´ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- í‰ê°€ íŒ¨ë„ -->
                    <div class="stage-panel" data-stage-panel="eval">
                        <!-- í‰ê°€ ë©”íŠ¸ë¦­ ë¸”ë¡ -->
                        <div class="block block-eval">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    í‰ê°€ ë©”íŠ¸ë¦­
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="checkbox-group">
                                    <div class="checkbox-item">
                                        <input type="checkbox" name="metrics" value="accuracy" id="metric_accuracy" {% if 'accuracy' in form_state.metrics|default(['accuracy']) %}checked{% endif %}>
                                        <label for="metric_accuracy">Accuracy</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" name="metrics" value="precision" id="metric_precision" {% if 'precision' in form_state.metrics|default([]) %}checked{% endif %}>
                                        <label for="metric_precision">Precision</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" name="metrics" value="recall" id="metric_recall" {% if 'recall' in form_state.metrics|default([]) %}checked{% endif %}>
                                        <label for="metric_recall">Recall</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" name="metrics" value="f1" id="metric_f1" {% if 'f1' in form_state.metrics|default([]) %}checked{% endif %}>
                                        <label for="metric_f1">F1-Score</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ì‹œê°í™” ë¸”ë¡ -->
                        <div class="block block-eval">
                            <div class="block-header">
                                <span class="block-title">
                                    <span class="block-status"></span>
                                    ê²°ê³¼ ì‹œê°í™”
                                </span>
                            </div>
                            <div class="block-content">
                                <div class="checkbox-item">
                                    <input type="checkbox" name="show_confusion_matrix" id="show_confusion_matrix" {% if form_state.show_confusion_matrix %}checked{% endif %}>
                                    <label for="show_confusion_matrix">í˜¼ë™ í–‰ë ¬ ì¶œë ¥</label>
                                </div>
                                <div class="block-field">
                                    <label for="viz_samples">ì˜ˆì¸¡ ìƒ˜í”Œ ìˆ˜</label>
                                    <input type="number" name="viz_samples" id="viz_samples" value="{{ form_state.viz_samples|default(10) }}" min="0" max="50">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ì•¡ì…˜ ë²„íŠ¼ - í˜„ì¬ ìŠ¤í…Œì´ì§€ì— ë”°ë¼ ë™ì ìœ¼ë¡œ í‘œì‹œ -->
                <div class="action-buttons">
                    <button type="submit" class="btn btn-primary" id="generate-btn" name="stage" value="pre">
                        ğŸŸ© ì „ì²˜ë¦¬ ì½”ë“œ ìƒì„±
                    </button>
                    <button type="submit" class="btn btn-success" name="stage" value="all">
                        ğŸ”— ì „ì²´ ì½”ë“œ ìƒì„±
                    </button>
                </div>
            </form>
        </aside>
        
        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="main-content">
            <!-- íƒ­ í—¤ë” -->
            <nav class="tab-header">
                <button class="tab-btn active" data-tab="code">
                    <span>ğŸ“</span> ì½”ë“œ
                </button>
                <button class="tab-btn" data-tab="data">
                    <span>ğŸ“Š</span> ë°ì´í„°
                </button>
                <button class="tab-btn" data-tab="log">
                    <span>ğŸ“‹</span> ë¡œê·¸
                </button>
            </nav>
            
            <!-- íƒ­ ì½˜í…ì¸  -->
            <div class="tab-content">
                <!-- ì½”ë“œ íŒ¨ë„ -->
                <div class="tab-panel active" data-panel="code">
                    <div class="code-header">
                        <h3 id="code-title">ì „ì²˜ë¦¬ ì½”ë“œ</h3>
                        <div class="code-actions">
                            <button class="btn btn-secondary" onclick="downloadCode()">
                                ğŸ“¥ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <button class="btn btn-primary" onclick="runCode()">
                                â–¶ï¸ ì‹¤í–‰
                            </button>
                        </div>
                    </div>
                    <div id="code-content">
                        {% if snippet_pre %}
                        <pre class="code-view">{{ snippet_pre|e }}</pre>
                        {% else %}
                        <div class="empty-state">
                            <h3>ì½”ë“œê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</h3>
                            <p>ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ ì„¤ì •ì„ ì™„ë£Œí•˜ê³  'ìƒì„±' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- ë°ì´í„° íŒ¨ë„ -->
                <div class="tab-panel" data-panel="data">
                    <div class="empty-state">
                        <h3>ë°ì´í„° ë·°ì–´</h3>
                        <p>ë°ì´í„°ì…‹ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
                
                <!-- ë¡œê·¸ íŒ¨ë„ -->
                <div class="tab-panel" data-panel="log">
                    <div class="log-container">
                        <div class="log-controls">
                            <h3 id="log-title">ì „ì²˜ë¦¬ ë¡œê·¸</h3>
                            <div>
                                <button class="btn btn-secondary" onclick="clearLog()">
                                    ğŸ—‘ï¸ ì§€ìš°ê¸°
                                </button>
                                <button class="btn btn-danger" onclick="stopExecution()">
                                    â¹ï¸ ì¤‘ì§€
                                </button>
                            </div>
                        </div>
                        <div class="log-viewer" id="log-viewer">
                            <div id="log-content"></div>
                        </div>
                        <div class="log-status">
                            <span class="status-indicator" id="status-indicator">
                                <span class="status-dot"></span>
                                <span id="status-text">ëŒ€ê¸° ì¤‘</span>
                            </span>
                            <span>SSE ì‹¤ì‹œê°„ ë¡œê·¸</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- ì„œë²„ ë°ì´í„° (Flask ì‚¬ìš© ì‹œ) -->
    <script id="server-data" type="application/json">
    {
        "snippets": {
            "pre": null,
            "model": null,
            "train": null,
            "eval": null
        }
    }
    </script>

    <script>
        // ì „ì—­ ìƒíƒœ ê´€ë¦¬
        const AppState = {
            activeMainTab: 'code',
            activeStage: 'pre',
            formData: {},
            eventSource: null,
            isRunning: false,
            snippets: {
                pre: null,
                model: null,
                train: null,
                eval: null
            }
        };

        // ì„œë²„ì—ì„œ ë°›ì€ ìŠ¤ë‹ˆí« ë°ì´í„° ë¡œë“œ (Flask ì‚¬ìš© ì‹œ)
        // í…œí”Œë¦¿ ì—”ì§„ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš° ì´ ë¶€ë¶„ì€ ì œê±°í•˜ê±°ë‚˜ 
        // AJAXë¡œ ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ìˆ˜ì •
        try {
            // Flask í…œí”Œë¦¿ ì‚¬ìš© ì‹œ ì„œë²„ì—ì„œ ë Œë”ë§ëœ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸°
            const serverData = document.getElementById('server-data');
            if (serverData) {
                const data = JSON.parse(serverData.textContent);
                AppState.snippets = data.snippets || AppState.snippets;
            }
        } catch (e) {
            console.log('No server data found, using defaults');
        }

        // DOMì´ ë¡œë“œë˜ë©´ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            console.log('Initializing app...');
            
            // ì»´í¬ë„ŒíŠ¸ ì´ˆê¸°í™”
            initMainTabs();
            initStageTabs();
            initConditionalFields();
            initFormHandlers();
            
            console.log('App initialized');
        }

        // ë©”ì¸ íƒ­ ì´ˆê¸°í™”
        function initMainTabs() {
            const tabButtons = document.querySelectorAll('.tab-header .tab-btn');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabName = this.dataset.tab;
                    switchMainTab(tabName);
                });
            });
        }

        function switchMainTab(tabName) {
            // íƒ­ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.tab-header .tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabName);
            });
            
            // íƒ­ íŒ¨ë„ ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.toggle('active', panel.dataset.panel === tabName);
            });
            
            AppState.activeMainTab = tabName;
        }

        // ìŠ¤í…Œì´ì§€ íƒ­ ì´ˆê¸°í™” - ì™¼ìª½ 4ë‹¨ê³„ íƒ­
        function initStageTabs() {
            const stageButtons = document.querySelectorAll('.stage-tabs .stage-tab');
            
            stageButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    const stage = this.dataset.stage;
                    switchStageTab(stage);
                });
            });
        }

        function switchStageTab(stage) {
            // íƒ­ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.stage-tabs .stage-tab').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.stage === stage);
            });
            
            // ìŠ¤í…Œì´ì§€ íŒ¨ë„ ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.stage-panel').forEach(panel => {
                panel.classList.toggle('active', panel.dataset.stagePanel === stage);
            });
            
            AppState.activeStage = stage;
            
            // ìƒì„± ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            updateGenerateButton(stage);
            
            // ì½”ë“œ ë·° ì—…ë°ì´íŠ¸
            updateCodeView(stage);
            
            // ë¡œê·¸ ì œëª© ì—…ë°ì´íŠ¸
            updateLogTitle(stage);
        }

        // ìƒì„± ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateGenerateButton(stage) {
            const btn = document.getElementById('generate-btn');
            if (btn) {
                const stageNames = {
                    'pre': 'ğŸŸ© ì „ì²˜ë¦¬',
                    'model': 'ğŸŸ¦ ëª¨ë¸',
                    'train': 'ğŸŸ§ í•™ìŠµ',
                    'eval': 'ğŸŸ¥ í‰ê°€'
                };
                btn.textContent = stageNames[stage] + ' ì½”ë“œ ìƒì„±';
                btn.value = stage;
                btn.className = 'btn btn-stage-' + stage;
            }
        }

        // ì½”ë“œ ë·° ì—…ë°ì´íŠ¸
        function updateCodeView(stage) {
            const codeTitle = document.getElementById('code-title');
            const codeContent = document.getElementById('code-content');
            
            const titles = {
                'pre': 'ì „ì²˜ë¦¬ ì½”ë“œ',
                'model': 'ëª¨ë¸ ì½”ë“œ',
                'train': 'í•™ìŠµ ì½”ë“œ',
                'eval': 'í‰ê°€ ì½”ë“œ'
            };
            
            if (codeTitle) {
                codeTitle.textContent = titles[stage];
            }
            
            if (codeContent) {
                const snippet = AppState.snippets[stage];
                if (snippet) {
                    codeContent.innerHTML = `<pre class="code-view">${escapeHtml(snippet)}</pre>`;
                } else {
                    codeContent.innerHTML = `
                        <div class="empty-state">
                            <h3>${titles[stage]}ê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</h3>
                            <p>ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ ì„¤ì •ì„ ì™„ë£Œí•˜ê³  'ìƒì„±' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                        </div>
                    `;
                }
            }
        }

        // ë¡œê·¸ ì œëª© ì—…ë°ì´íŠ¸
        function updateLogTitle(stage) {
            const logTitle = document.getElementById('log-title');
            const titles = {
                'pre': 'ì „ì²˜ë¦¬ ë¡œê·¸',
                'model': 'ëª¨ë¸ ë¡œê·¸',
                'train': 'í•™ìŠµ ë¡œê·¸',
                'eval': 'í‰ê°€ ë¡œê·¸'
            };
            
            if (logTitle) {
                logTitle.textContent = titles[stage];
            }
        }

        // ì¡°ê±´ë¶€ í•„ë“œ ì´ˆê¸°í™”
        function initConditionalFields() {
            // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚¬ìš© ì—¬ë¶€
            const isTestSelect = document.getElementById('is_test');
            if (isTestSelect) {
                const updateTestFields = function() {
                    const useTest = isTestSelect.value === 'true';
                    const testDiv = document.getElementById('test-div');
                    const ratioDiv = document.getElementById('ratio-div');
                    
                    if (testDiv) {
                        testDiv.classList.toggle('hidden', !useTest);
                    }
                    
                    if (ratioDiv) {
                        ratioDiv.classList.toggle('hidden', useTest);
                    }
                };
                
                isTestSelect.addEventListener('change', updateTestFields);
                updateTestFields(); // ì´ˆê¸° ìƒíƒœ ì„¤ì •
            }
        }

        // í¼ í•¸ë“¤ëŸ¬ ì´ˆê¸°í™”
        function initFormHandlers() {
            const form = document.getElementById('pipeline-form');
            
            if (form) {
                // í¼ ì œì¶œ ì²˜ë¦¬
                form.addEventListener('submit', function(e) {
                    // ê¸°ë³¸ ë™ì‘ ìœ ì§€ (ì„œë²„ë¡œ ì „ì†¡)
                    console.log('Form submitted with stage:', e.submitter?.value);
                });
                
                // í¼ ì…ë ¥ ë³€ê²½ ê°ì§€
                form.addEventListener('change', function(e) {
                    const { name, value } = e.target;
                    if (name) {
                        AppState.formData[name] = value;
                    }
                });
            }
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ì½”ë“œ ë‹¤ìš´ë¡œë“œ
        function downloadCode() {
            const stage = AppState.activeStage;
            window.location.href = `/download/${stage}`;
        }

        // ì½”ë“œ ì‹¤í–‰
        async function runCode() {
            const stage = AppState.activeStage;
            
            // ë¡œê·¸ íƒ­ìœ¼ë¡œ ì „í™˜
            switchMainTab('log');
            
            // ë¡œê·¸ ì´ˆê¸°í™”
            clearLog();
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            AppState.isRunning = true;
            updateStatus('running');
            
            try {
                // ì‹¤í–‰ ìš”ì²­
                const response = await fetch(`/run/${stage}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (data.ok) {
                    // SSE ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘
                    startLogStream(stage);
                } else {
                    throw new Error(data.error || 'ì‹¤í–‰ ì‹¤íŒ¨');
                }
            } catch (error) {
                appendLog(`ì˜¤ë¥˜: ${error.message}`, 'error');
                AppState.isRunning = false;
                updateStatus('error');
            }
        }

        // SSE ë¡œê·¸ ìŠ¤íŠ¸ë¦¬ë°
        function startLogStream(stage) {
            // ê¸°ì¡´ ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ
            if (AppState.eventSource) {
                AppState.eventSource.close();
            }
            
            // ìƒˆ ìŠ¤íŠ¸ë¦¼ ì‹œì‘
            AppState.eventSource = new EventSource(`/logs/stream?stage=${stage}`);
            
            AppState.eventSource.onmessage = function(event) {
                appendLog(event.data);
            };
            
            AppState.eventSource.onerror = function(error) {
                console.error('SSE error:', error);
                stopExecution();
            };
        }

        // ë¡œê·¸ ì¶”ê°€
        function appendLog(message, type = 'normal') {
            const logContent = document.getElementById('log-content');
            if (logContent) {
                const logLine = document.createElement('div');
                logLine.className = 'log-line ' + type;
                logLine.textContent = message;
                logContent.appendChild(logLine);
                
                // ìë™ ìŠ¤í¬ë¡¤
                const logViewer = document.getElementById('log-viewer');
                if (logViewer) {
                    logViewer.scrollTop = logViewer.scrollHeight;
                }
            }
        }

        // ë¡œê·¸ ì§€ìš°ê¸°
        function clearLog() {
            const logContent = document.getElementById('log-content');
            if (logContent) {
                logContent.innerHTML = '';
            }
        }

        // ì‹¤í–‰ ì¤‘ì§€
        function stopExecution() {
            if (AppState.eventSource) {
                AppState.eventSource.close();
                AppState.eventSource = null;
            }
            AppState.isRunning = false;
            updateStatus('stopped');
            appendLog('ì‹¤í–‰ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(status) {
            const indicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            
            if (indicator) {
                indicator.className = 'status-indicator ' + (status === 'running' ? 'running' : '');
            }
            
            if (statusText) {
                const texts = {
                    'running': 'ì‹¤í–‰ ì¤‘',
                    'stopped': 'ì¤‘ì§€ë¨',
                    'error': 'ì˜¤ë¥˜',
                    'idle': 'ëŒ€ê¸° ì¤‘'
                };
                statusText.textContent = texts[status] || 'ëŒ€ê¸° ì¤‘';
            }
        }
    </script>
</body>
</html>